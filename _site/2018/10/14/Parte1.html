<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Parte 1: Processamento Digital da Imagem | Braço Pontilhismo</title>
<meta name="generator" content="Jekyll v3.8.3" />
<meta property="og:title" content="Parte 1: Processamento Digital da Imagem" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Olá leitor!" />
<meta property="og:description" content="Olá leitor!" />
<link rel="canonical" href="http://localhost:4000/2018/10/14/Parte1.html" />
<meta property="og:url" content="http://localhost:4000/2018/10/14/Parte1.html" />
<meta property="og:site_name" content="Braço Pontilhismo" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-10-14T20:04:32-03:00" />
<script type="application/ld+json">
{"description":"Olá leitor!","@type":"BlogPosting","url":"http://localhost:4000/2018/10/14/Parte1.html","headline":"Parte 1: Processamento Digital da Imagem","dateModified":"2018-10-14T20:04:32-03:00","datePublished":"2018-10-14T20:04:32-03:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2018/10/14/Parte1.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Braço Pontilhismo" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Braço Pontilhismo</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Parte 1: Processamento Digital da Imagem</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-10-14T20:04:32-03:00" itemprop="datePublished">Oct 14, 2018
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h4 id="olá-leitor">Olá leitor!</h4>

<p>Neste post irei mostrar o algoritimo pensado para processar a imagem que será dada pelo usuário. Foi utilizado C++ para a construção do algorítimo e OpenCV. OpenCV é uma bibliotéca gratúita e <em>open source</em> dedicada em facilitar a mainpulação de imagens para visão computacional.</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
</pre></td><td class="code"><pre><span class="cp">#include &lt;iostream&gt;
#include "opencv2/opencv.hpp"
#include &lt;vector&gt;
#include &lt;math.h&gt;
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>

<span class="c1">//ALGORITIMO BSAS - BASIC SEQUENCIAL ALGORITHM SCHEME</span>
<span class="kt">void</span> <span class="n">bsas</span> <span class="p">(</span><span class="kt">int</span> <span class="n">p</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">arr_x</span><span class="p">,</span>
	   <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">arr_y</span><span class="p">,</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">result</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">arr_x</span><span class="p">.</span><span class="n">empty</span><span class="p">()){}</span>
  <span class="k">else</span><span class="p">{</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">aux</span><span class="p">,</span> <span class="n">ldrs_x</span><span class="p">,</span> <span class="n">ldrs_y</span><span class="p">,</span> <span class="n">dist</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">rho</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>

    <span class="c1">//randomizando o primeiro leader</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">arr_x</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="n">aux</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="cm">/*criando um vetor de 0 
                          até o tamanho do array*/</span>
    <span class="n">random_shuffle</span><span class="p">(</span><span class="n">aux</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">aux</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
    <span class="n">ldrs_x</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">arr_x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">aux</span><span class="p">.</span><span class="n">front</span><span class="p">()));</span>
    <span class="n">ldrs_y</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">arr_y</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">aux</span><span class="p">.</span><span class="n">front</span><span class="p">()));</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">arr_x</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>

    <span class="c1">//calcular a distancia do dado atual para todos os lideres</span>
      <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">k</span><span class="o">&lt;</span><span class="n">ldrs_x</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">k</span><span class="o">++</span><span class="p">){</span>
        <span class="c1">//sqrt(x*x + y*y)</span>
        <span class="n">dist</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">sqrt</span><span class="p">((</span><span class="n">arr_x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">aux</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">-</span> <span class="n">ldrs_x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
			<span class="o">*</span><span class="p">(</span><span class="n">arr_x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">aux</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">-</span> <span class="n">ldrs_x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
		        <span class="o">+</span> <span class="p">(</span><span class="n">arr_y</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">aux</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">-</span> <span class="n">ldrs_y</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
			<span class="o">*</span><span class="p">(</span><span class="n">arr_y</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">aux</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">-</span> <span class="n">ldrs_y</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">k</span><span class="p">))));</span>
      <span class="p">}</span>

    <span class="c1">//pegando a distancia minima</span>
      <span class="n">sort</span><span class="p">(</span><span class="n">dist</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">dist</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
      <span class="n">d</span> <span class="o">=</span> <span class="n">dist</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
      <span class="n">dist</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    
    <span class="c1">//checando se o dado atual é um novo leader</span>
      <span class="k">if</span><span class="p">(</span><span class="n">d</span><span class="o">&gt;</span><span class="n">rho</span><span class="p">){</span>
        <span class="n">ldrs_x</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">arr_x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">aux</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)));</span>
        <span class="n">ldrs_y</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">arr_y</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">aux</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)));</span>
      <span class="p">}</span>
    <span class="p">}</span>

  <span class="c1">//RECONSTRUIR IMAGEM</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">ldrs_x</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
      <span class="n">result</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ldrs_x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">ldrs_y</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//______________________________________________</span>
<span class="c1">//                    MAIN</span>
<span class="c1">//______________________________________________</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span><span class="n">argv</span><span class="p">){</span>
  <span class="n">Mat</span> <span class="n">image</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">escala</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">f</span><span class="p">;</span>

<span class="c1">//LENDO O ARGUMENTO DO PROGRAMA EM ESCALA CINZA</span>
  <span class="n">image</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">);</span>

<span class="c1">//Reescalar imagem se for muito grande</span>
  <span class="k">if</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="o">&gt;</span><span class="n">escala</span><span class="o">||</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="o">&gt;</span><span class="n">escala</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="o">&gt;=</span><span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">){</span>
      <span class="n">f</span> <span class="o">=</span> <span class="n">escala</span><span class="o">/</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span>
      <span class="n">resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">image</span><span class="p">,</span><span class="n">Size</span><span class="p">(),</span><span class="n">f</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">INTER_CUBIC</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="n">f</span> <span class="o">=</span> <span class="n">escala</span><span class="o">/</span><span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span>
      <span class="n">resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">image</span><span class="p">,</span><span class="n">Size</span><span class="p">(),</span><span class="n">f</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">INTER_CUBIC</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="c1">//homogenização do histograma</span>
  <span class="kt">int</span> <span class="n">nClusters</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
  <span class="n">Mat</span> <span class="n">labels</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nRounds</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="n">Mat</span> <span class="n">centers</span><span class="p">;</span>

  <span class="n">Mat</span> <span class="n">data</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">rows</span> <span class="o">*</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">CV_32F</span><span class="p">);</span>

  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">){</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span> <span class="p">){</span>
      <span class="n">data</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="c1">//Aplicação do Kmeans</span>
  <span class="n">kmeans</span><span class="p">(</span><span class="n">data</span><span class="p">,</span>
	 <span class="n">nClusters</span><span class="p">,</span>
	 <span class="n">labels</span><span class="p">,</span>
	 <span class="n">TermCriteria</span><span class="p">(</span><span class="n">TermCriteria</span><span class="o">::</span><span class="n">MAX_ITER</span><span class="o">+</span><span class="n">TermCriteria</span><span class="o">::</span><span class="n">EPS</span><span class="p">,</span>
		      <span class="mi">10000</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">),</span>
	 <span class="n">nRounds</span><span class="p">,</span>
	 <span class="n">KMEANS_PP_CENTERS</span><span class="p">,</span>
	 <span class="n">centers</span> <span class="p">);</span>

<span class="c1">//Montando a imagem após o kmeans</span>
  <span class="n">Mat</span> <span class="n">labeled</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">image</span><span class="p">.</span><span class="n">type</span><span class="p">());</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">){</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span> <span class="p">){</span>
      <span class="n">labeled</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">centers</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span>
			<span class="n">labels</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">+</span> <span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="c1">//Coleta dos centros do histograma</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">cent</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">centers</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="n">cent</span><span class="p">.</span><span class="n">push_back</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span> <span class="n">centers</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">));</span>
  <span class="p">}</span>

<span class="c1">//Ordenar do centro de menor valor pro maior</span>
  <span class="n">sort</span><span class="p">(</span><span class="n">cent</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">cent</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="n">reverse</span><span class="p">(</span><span class="n">cent</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">cent</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>

<span class="c1">//Camadas</span>
  <span class="n">Mat</span> <span class="n">pontilhismo</span><span class="p">;</span>
  <span class="n">pontilhismo</span> <span class="o">=</span> <span class="n">Mat</span><span class="o">::</span><span class="n">ones</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">,</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">,</span><span class="n">CV_8UC1</span><span class="p">)</span><span class="o">*</span><span class="mi">255</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">camada_x</span><span class="p">,</span> <span class="n">camada_y</span><span class="p">;</span>

  <span class="kt">int</span> <span class="n">a</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">nClusters</span><span class="p">;</span> <span class="n">a</span><span class="o">++</span><span class="p">){</span>
    <span class="n">camada_x</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="n">camada_y</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
      <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">){</span>
        <span class="c1">//coleta das posições da camada atual</span>
        <span class="k">if</span><span class="p">(</span><span class="n">labeled</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="n">cent</span><span class="p">.</span><span class="n">back</span><span class="p">()){</span>
          <span class="n">camada_x</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
          <span class="n">camada_y</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">//aplicação do BSAS para camada atual</span>
    <span class="n">bsas</span><span class="p">(</span><span class="n">cent</span><span class="p">.</span><span class="n">back</span><span class="p">()</span><span class="o">*</span><span class="mi">10</span><span class="o">/</span><span class="mi">255</span><span class="o">+</span><span class="mi">2</span> <span class="o">+</span> <span class="n">a</span><span class="o">*</span><span class="mf">0.2</span><span class="p">,</span><span class="n">camada_x</span><span class="p">,</span>
	 <span class="n">camada_y</span><span class="p">,</span><span class="n">pontilhismo</span><span class="p">);</span>
    <span class="n">cent</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
  <span class="p">}</span>

<span class="c1">//BORDAS</span>
  <span class="n">Mat</span> <span class="n">canny</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">thresh</span> <span class="o">=</span> <span class="mi">45</span><span class="p">;</span>
  <span class="n">Canny</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">canny</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">thresh</span><span class="p">);</span>
  <span class="n">camada_x</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
  <span class="n">camada_y</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>

  <span class="c1">//coleta das posições da borda encontrada</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="n">canny</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">255</span><span class="p">){</span>
        <span class="n">camada_x</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="n">camada_y</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">canny</span> <span class="o">=</span> <span class="n">Mat</span><span class="o">::</span><span class="n">ones</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">,</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">,</span><span class="n">CV_8UC1</span><span class="p">)</span><span class="o">*</span><span class="mi">255</span><span class="p">;</span>

  <span class="c1">//aplicação do BSAS na borda</span>
  <span class="n">bsas</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">camada_x</span><span class="p">,</span><span class="n">camada_y</span><span class="p">,</span><span class="n">canny</span><span class="p">);</span>

  <span class="c1">//Adicionando os pontos da borda processada na imagem final</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="n">canny</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
        <span class="n">pontilhismo</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="c1">//ESCREVER A IMAGEM FINAL</span>
  <span class="n">imwrite</span><span class="p">(</span><span class="s">"labeled.png"</span><span class="p">,</span> <span class="n">labeled</span><span class="p">);</span> 
  <span class="n">imwrite</span><span class="p">(</span><span class="s">"pontilhismo.png"</span><span class="p">,</span> <span class="n">pontilhismo</span><span class="p">);</span> 
<span class="p">}</span></pre></td></tr></tbody></table></code></pre></figure>

<h3 id="bibliotécas">Bibliotécas</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;iostream&gt;
#include "opencv2/opencv.hpp"
#include &lt;vector&gt;
#include &lt;math.h&gt;
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
</code></pre></div></div>
<ul>
  <li><code class="highlighter-rouge">iostream</code> e <code class="highlighter-rouge">namespace std</code> é o basico para qualquer programa em C++;</li>
  <li><code class="highlighter-rouge">opencv2/opencv.hpp</code> e <code class="highlighter-rouge">namespace cv</code> são incluídos para utilizar o OpenCV;</li>
  <li><code class="highlighter-rouge">vector</code> é uma bilbiotéca de lista, que facilita muito no código;</li>
  <li>E por fim, <code class="highlighter-rouge">math.h</code> é incluída para fazer uns cálculos matemáticos.</li>
</ul>

<h3 id="bsas">BSAS</h3>

<p>Antes de entrarmos na explicação da <em>main</em> tentarei explicar a função definida como <code class="highlighter-rouge">bsas</code>. A ideia por tras dela é a mesma explicada no post anterior.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//ALGORITIMO BSAS - BASIC SEQUENCIAL ALGORITHM SCHEME</span>
<span class="kt">void</span> <span class="n">bsas</span> <span class="p">(</span><span class="kt">int</span> <span class="n">p</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">arr_x</span><span class="p">,</span>
	   <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">arr_y</span><span class="p">,</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">result</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">arr_x</span><span class="p">.</span><span class="n">empty</span><span class="p">()){}</span>
  <span class="k">else</span><span class="p">{</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">aux</span><span class="p">,</span> <span class="n">ldrs_x</span><span class="p">,</span> <span class="n">ldrs_y</span><span class="p">,</span> <span class="n">dist</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">rho</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>

    <span class="c1">//randomizando o primeiro leader</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">arr_x</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="n">aux</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="cm">/*criando um vetor de 0 
                          até o tamanho do array*/</span>
    <span class="n">random_shuffle</span><span class="p">(</span><span class="n">aux</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">aux</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
    <span class="n">ldrs_x</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">arr_x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">aux</span><span class="p">.</span><span class="n">front</span><span class="p">()));</span>
    <span class="n">ldrs_y</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">arr_y</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">aux</span><span class="p">.</span><span class="n">front</span><span class="p">()));</span>
</code></pre></div></div>

<p>Primeiro se checa se o vetor utilizado como argumento de entrada está vazio ou não. Se ele estiver vazio ele não faz nada. Caso contrário, ele randomiza o primeiro lider e aloca ele no vetor de liders.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">arr_x</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>

    <span class="c1">//calcular a distancia do dado atual para todos os lideres</span>
      <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">k</span><span class="o">&lt;</span><span class="n">ldrs_x</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">k</span><span class="o">++</span><span class="p">){</span>
        <span class="c1">//sqrt(x*x + y*y)</span>
        <span class="n">dist</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">sqrt</span><span class="p">((</span><span class="n">arr_x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">aux</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">-</span> <span class="n">ldrs_x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
			<span class="o">*</span><span class="p">(</span><span class="n">arr_x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">aux</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">-</span> <span class="n">ldrs_x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
		        <span class="o">+</span> <span class="p">(</span><span class="n">arr_y</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">aux</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">-</span> <span class="n">ldrs_y</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
			<span class="o">*</span><span class="p">(</span><span class="n">arr_y</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">aux</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">-</span> <span class="n">ldrs_y</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">k</span><span class="p">))));</span>
      <span class="p">}</span>

    <span class="c1">//pegando a distancia minima</span>
      <span class="n">sort</span><span class="p">(</span><span class="n">dist</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">dist</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
      <span class="n">d</span> <span class="o">=</span> <span class="n">dist</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
      <span class="n">dist</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    
    <span class="c1">//checando se o dado atual é um novo leader</span>
      <span class="k">if</span><span class="p">(</span><span class="n">d</span><span class="o">&gt;</span><span class="n">rho</span><span class="p">){</span>
        <span class="n">ldrs_x</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">arr_x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">aux</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)));</span>
        <span class="n">ldrs_y</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">arr_y</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">aux</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)));</span>
      <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Faz se uma varredura em todos os dados do vetor calculando a distancia aritmética entre o dado atual e todos os lideres conhecidos até então. Após isso, verifica se a distancia minima achada é maior que a tolerância <code class="highlighter-rouge">rho</code>. Se for, o dado atual é classificado como novo lider e é alocado no vetor de lideres.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">//RECONSTRUIR IMAGEM</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">ldrs_x</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
      <span class="n">result</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ldrs_x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">ldrs_y</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Por fim, é imprimido o resultado obtido na imagem de entrada.</p>

<h3 id="main">Main</h3>

<p>Agora sim entraremos na explicação da <em>main</em>.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//______________________________________________</span>
<span class="c1">//                    MAIN</span>
<span class="c1">//______________________________________________</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span><span class="n">argv</span><span class="p">){</span>
  <span class="n">Mat</span> <span class="n">image</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">escala</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">f</span><span class="p">;</span>

<span class="c1">//LENDO O ARGUMENTO DO PROGRAMA EM ESCALA CINZA</span>
  <span class="n">image</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">);</span>

<span class="c1">//Reescalar imagem se for muito grande</span>
  <span class="k">if</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="o">&gt;</span><span class="n">escala</span><span class="o">||</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="o">&gt;</span><span class="n">escala</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="o">&gt;=</span><span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">){</span>
      <span class="n">f</span> <span class="o">=</span> <span class="n">escala</span><span class="o">/</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span>
      <span class="n">resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">image</span><span class="p">,</span><span class="n">Size</span><span class="p">(),</span><span class="n">f</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">INTER_CUBIC</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="n">f</span> <span class="o">=</span> <span class="n">escala</span><span class="o">/</span><span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span>
      <span class="n">resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">image</span><span class="p">,</span><span class="n">Size</span><span class="p">(),</span><span class="n">f</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">INTER_CUBIC</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>Primeiro, é definido um tamanho máximo para a imagem em <code class="highlighter-rouge">escala</code>, no nosso caso foi utilizado 512. Se lê o primeiro argumento, passado na execução do programa, como uma imagem em escala cinza. É verificado se a imagem possui alguma dimensão maior que 512, se não for, não se faz nada. Caso contrário a imagem é reescalada para 512 proporcionalmente.</p>

  </div><a class="u-url" href="/2018/10/14/Parte1.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Braço Pontilhismo</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Braço Pontilhismo</li><li><a class="u-email" href="mailto:las-9@hotmail.com">las-9@hotmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/luccasbonato"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">luccasbonato</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Blog dedicado para documentar um projeto que estou desenvolvendo durante meu curso de Engenharia Elétrica na UFRN. A ideia principal do projeto é controlar um braço robótico, através de servo motores, para que consiga desenhar uma imagem qualquer dada através de uma técnica de desenho chamada de pontilhismo.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
